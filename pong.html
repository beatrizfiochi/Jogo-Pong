<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nosso primeiro jogo</title>
</head>
<body>
    <canvas width="1600" height="1200"> </canvas>
    <script>
        var tela = document.querySelector('canvas');
        var pincel = tela.getContext('2d');

        var corFundo = 'black';

        function criarFundo(){

            //coloca p tamanho máximo da tela
            pincel.canvas.width  = window.innerWidth - 20; 
            pincel.canvas.height = window.innerHeight - 20;

            // Atualiza posição do quadrado, pq ele depende do tamanho da tela
            posicaoXQuadrado = ((pincel.canvas.width - tamanhoQuadrado)/2);
            posicaoYQuadrado = ((pincel.canvas.height - tamanhoQuadrado)/2);

            pincel.fillStyle = corFundo;
            pincel.fillRect(0, 0, pincel.canvas.width, pincel.canvas.height);
        }

        var borda = 20;
        var yEsquerda = borda;
        var yDireita = borda;
        var larguraJogador = 40;
        var alturaJogador = 200;


        function desenhoJogadorEsquerda(){
            pincel.fillStyle = 'blue';
            pincel.fillRect(borda, yEsquerda, larguraJogador, alturaJogador);
        }

        function desenhoJogadorDireita(){
            pincel.fillStyle = 'red';
            pincel.fillRect(pincel.canvas.width - borda - larguraJogador, yDireita, larguraJogador, alturaJogador);
        }

        var taxaIncrementoY = 40;

        function moveJogadorEsquerda(sentido){
            // Apaga
            pincel.fillStyle = corFundo;
            pincel.fillRect(borda, yEsquerda, larguraJogador, alturaJogador);

            // Calcula
            yEsquerda = yEsquerda + (taxaIncrementoY*sentido);
            if (yEsquerda < borda){
                yEsquerda = borda;
            } else if (yEsquerda > pincel.canvas.height - borda - alturaJogador){
                yEsquerda = pincel.canvas.height - borda - alturaJogador;
            }

            // Desenha
            desenhoJogadorEsquerda();
 
        }

        function moveJogadorDireita(sentido){
            // Apaga
            pincel.fillStyle = corFundo;
            pincel.fillRect(pincel.canvas.width - borda - larguraJogador, yDireita, larguraJogador, alturaJogador);

            // Calcula
            yDireita = yDireita + (taxaIncrementoY*sentido);
            if (yDireita < borda){
                yDireita = borda;
            } else if (yDireita > pincel.canvas.height - borda - alturaJogador){
                yDireita = pincel.canvas.height - borda - alturaJogador;
            }
            // Desenha
            desenhoJogadorDireita();
        }

        //códigos do teclado jogador esquerda W e S
        var cimaJogadorEsquerda = 87;
        var baixoJogadorEsquerda = 83;
                
        //códigos do teclado jogador direita
        var cimaJogadorDireita = 38;
        var baixoJogadorDireita = 40;


        function leTeclado(evento){
            if (evento.keyCode == baixoJogadorEsquerda){
                moveJogadorEsquerda(1);
            } else if (evento.keyCode == cimaJogadorEsquerda){
                moveJogadorEsquerda(-1);
            } else if (evento.keyCode == baixoJogadorDireita){
                moveJogadorDireita(1);
            } else if (evento.keyCode == cimaJogadorDireita){
                moveJogadorDireita(-1);
            } 
        }
        
        var tamanhoQuadrado = 40;
        var angulo = 30;
        var Vx = 10;
        var Vy = 10;
        // Os valores de posição serão atualizados quando chamar o criarFundo
        var posicaoXQuadrado = 0;
        var posicaoYQuadrado = 0;

        function desenhaQuadrado(){
            pincel.fillStyle = 'white';
            pincel.fillRect(posicaoXQuadrado, posicaoYQuadrado, tamanhoQuadrado, tamanhoQuadrado);
        }

        function moveQuadrado(){
            // Apaga
            pincel.fillStyle = corFundo;
            // Nao sei pq, mas não estava apagando o quadrado todo usando a mesma posição e tamanho. Então estou apagando um quadrado maior
            pincel.fillRect(posicaoXQuadrado - 1, posicaoYQuadrado - 1, tamanhoQuadrado + 2, tamanhoQuadrado + 2);

            //Calcula
            posicaoXQuadrado = posicaoXQuadrado + Vx;
            posicaoYQuadrado = posicaoYQuadrado + Vy;

            //Verifica se passou dos limites superior e inferior da tela
            if (posicaoYQuadrado < borda){
                posicaoYQuadrado = borda;
                Vy = Vy * -1;
            } else if (posicaoYQuadrado > (pincel.canvas.height - borda - tamanhoQuadrado)){
                posicaoYQuadrado = (pincel.canvas.height - borda - tamanhoQuadrado);
                Vy = Vy * -1;
            }

            //Verifica se foi gol
            if(posicaoXQuadrado < 0 - tamanhoQuadrado){
                posicaoXQuadrado = ((pincel.canvas.width - tamanhoQuadrado)/2);
                posicaoYQuadrado = ((pincel.canvas.height - tamanhoQuadrado)/2);
                // teste
                Vx = Vx * -1;
            } else if(posicaoXQuadrado > pincel.canvas.width + tamanhoQuadrado){
                posicaoXQuadrado = ((pincel.canvas.width - tamanhoQuadrado)/2);
                posicaoYQuadrado = ((pincel.canvas.height - tamanhoQuadrado)/2);
                // teste
                Vx = Vx * -1;
            }

            //Desenha
            desenhaQuadrado();
        }

        criarFundo();
        desenhoJogadorEsquerda();
        desenhoJogadorDireita();
        desenhaQuadrado();
        moveQuadrado();

        document.onkeydown = leTeclado;

        setInterval(moveQuadrado, 20);

    </script>
</body>
</html>